-- MySQL Script generated by MySQL Workbench
-- Fri Mar 27 16:25:14 2020
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

DROP database finalproject;

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema FinalProject
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema FinalProject
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `FinalProject` DEFAULT CHARACTER SET utf8 ;
USE `FinalProject` ;

-- -----------------------------------------------------
-- Table `FinalProject`.`users`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `FinalProject`.`users` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `login` VARCHAR(45) NOT NULL,
  `password` VARCHAR(45) NOT NULL,
  `role` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `FinalProject`.`carriages`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `FinalProject`.`carriages` (
  `id_carriages` INT NOT NULL AUTO_INCREMENT,
  `carriages_name` VARCHAR(45) NOT NULL,
  `max_place` INT NOT NULL,
  `cost_factor` INT NOT NULL,
  PRIMARY KEY (`id_carriages`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `FinalProject`.`trains`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `FinalProject`.`trains` (
  `id_train` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id_train`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `FinalProject`.`station`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `FinalProject`.`station` (
  `id_station` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NOT NULL,
  `time_to_station` TIME NOT NULL,
  PRIMARY KEY (`id_station`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `FinalProject`.`railway_route`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `FinalProject`.`railway_route` (
  `id_railway_route` INT NOT NULL AUTO_INCREMENT,
  `id_train` INT NOT NULL,
  `start_way_date` DATE NOT NULL,
  `start_way_time` TIME NOT NULL,
  `free_place_type1` INT NOT NULL,
  `free_place_type2` INT NOT NULL,
  `free_place_type3` INT NOT NULL,
  PRIMARY KEY (`id_railway_route`),
  INDEX `fk_railway_route_trains1_idx` (`id_train` ASC) VISIBLE,
  CONSTRAINT `fk_railway_route_trains1`
    FOREIGN KEY (`id_train`)
    REFERENCES `FinalProject`.`trains` (`id_train`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `FinalProject`.`tickets`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `FinalProject`.`tickets` (
  `id_ticket` INT NOT NULL AUTO_INCREMENT,
  `users_id` INT NOT NULL,
  `id_railway_route` INT NOT NULL,
  `cost` INT NOT NULL,
  `start_station` VARCHAR(45) NOT NULL,
  `final_station` VARCHAR(45) NOT NULL,
  `start_travel` VARCHAR(45) NOT NULL,
  `end_travel` VARCHAR(45) NOT NULL,
  `place_type` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id_ticket`),
  INDEX `fk_tickets_users1_idx` (`users_id` ASC) VISIBLE,
  INDEX `fk_tickets_railway_route1_idx` (`id_railway_route` ASC) VISIBLE,
  CONSTRAINT `fk_tickets_users1`
    FOREIGN KEY (`users_id`)
    REFERENCES `FinalProject`.`users` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_tickets_railway_route1`
    FOREIGN KEY (`id_railway_route`)
    REFERENCES `FinalProject`.`railway_route` (`id_railway_route`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `FinalProject`.`trains_has_carriages`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `FinalProject`.`trains_has_carriages` (
  `id_trains_has_carriages` INT NOT NULL AUTO_INCREMENT,
  `trains_id_train` INT NOT NULL,
  `carriages_id_carriages` INT NOT NULL,
  `count_carriages` INT NOT NULL,
  INDEX `fk_trains_has_carriages_carriages1_idx` (`carriages_id_carriages` ASC) VISIBLE,
  INDEX `fk_trains_has_carriages_trains1_idx` (`trains_id_train` ASC) VISIBLE,
  PRIMARY KEY (`id_trains_has_carriages`),
  CONSTRAINT `fk_trains_has_carriages_trains1`
    FOREIGN KEY (`trains_id_train`)
    REFERENCES `FinalProject`.`trains` (`id_train`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_trains_has_carriages_carriages1`
    FOREIGN KEY (`carriages_id_carriages`)
    REFERENCES `FinalProject`.`carriages` (`id_carriages`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `FinalProject`.`station_has_railway_route`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `FinalProject`.`station_has_railway_route` (
  `id_station_has_railway_route` INT NOT NULL AUTO_INCREMENT,
  `station_id_station` INT NOT NULL,
  `railway_route_id_railway_route` INT NOT NULL,
  `stop_time` TIME NOT NULL,
  INDEX `fk_station_has_railway_route_railway_route1_idx` (`railway_route_id_railway_route` ASC) VISIBLE,
  INDEX `fk_station_has_railway_route_station1_idx` (`station_id_station` ASC) VISIBLE,
  PRIMARY KEY (`id_station_has_railway_route`),
  CONSTRAINT `fk_station_has_railway_route_station1`
    FOREIGN KEY (`station_id_station`)
    REFERENCES `FinalProject`.`station` (`id_station`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_station_has_railway_route_railway_route1`
    FOREIGN KEY (`railway_route_id_railway_route`)
    REFERENCES `FinalProject`.`railway_route` (`id_railway_route`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;




INSERT INTO users (login, password, role) VALUES ('admin', 'f6fdffe48c908deb0f4c3bd36c032e72', 'adm');
INSERT INTO users (login, password, role) VALUES ('client', 'd5bc32b75da65fe60067f501a4bb6665', 'user');

INSERT INTO carriages (carriages_name, max_place, cost_factor) VALUES ('cupe', 36 , 3 );
INSERT INTO carriages (carriages_name, max_place, cost_factor) VALUES ('reserved seat', 54 , 2 );
INSERT INTO carriages (carriages_name, max_place, cost_factor) VALUES ('common', 70 , 1 );

INSERT INTO trains (name) VALUES ('829');
INSERT INTO trains (name) VALUES ('912');
INSERT INTO trains (name) VALUES ('764');

INSERT INTO trains_has_carriages (trains_id_train, carriages_id_carriages, count_carriages ) VALUES (1, 1, 5);
INSERT INTO trains_has_carriages (trains_id_train, carriages_id_carriages, count_carriages ) VALUES (1, 2, 3);
INSERT INTO trains_has_carriages (trains_id_train, carriages_id_carriages, count_carriages ) VALUES (1, 3, 0);

INSERT INTO trains_has_carriages (trains_id_train, carriages_id_carriages, count_carriages ) VALUES (2, 1, 0);
INSERT INTO trains_has_carriages (trains_id_train, carriages_id_carriages, count_carriages ) VALUES (2, 2, 0);
INSERT INTO trains_has_carriages (trains_id_train, carriages_id_carriages, count_carriages ) VALUES (2, 3, 12);

INSERT INTO trains_has_carriages (trains_id_train, carriages_id_carriages, count_carriages ) VALUES (3, 1, 3);
INSERT INTO trains_has_carriages (trains_id_train, carriages_id_carriages, count_carriages ) VALUES (3, 2, 3);
INSERT INTO trains_has_carriages (trains_id_train, carriages_id_carriages, count_carriages ) VALUES (3, 3, 3);

INSERT INTO station (name, time_to_station) VALUES ('A1' , '00:00:00');
INSERT INTO station (name, time_to_station) VALUES ('A2' , '01:20:00');
INSERT INTO station (name, time_to_station) VALUES ('A3' , '01:15:00');
INSERT INTO station (name, time_to_station) VALUES ('A4' , '00:55:00');
INSERT INTO station (name, time_to_station) VALUES ('A5' , '02:30:00');
INSERT INTO station (name, time_to_station) VALUES ('A6' , '00:40:00');
INSERT INTO station (name, time_to_station) VALUES ('A7' , '01:30:00');
INSERT INTO station (name, time_to_station) VALUES ('A8' , '01:00:00');

INSERT INTO railway_route (id_train, start_way_date, start_way_time, free_place_type1, free_place_type2, free_place_type3) VALUES (1, '2020-05-10', '08:20:00', 180, 162, 0);
INSERT INTO railway_route (id_train, start_way_date, start_way_time, free_place_type1, free_place_type2, free_place_type3) VALUES (2, '2020-05-04', '12:00:00', 0, 0, 840);
INSERT INTO railway_route (id_train, start_way_date, start_way_time, free_place_type1, free_place_type2, free_place_type3) VALUES (3, '2020-05-12', '21:30:00', 108, 162, 210);

INSERT INTO station_has_railway_route (station_id_station, railway_route_id_railway_route, stop_time) VALUES (1, 1, '00:00:00');
INSERT INTO station_has_railway_route (station_id_station, railway_route_id_railway_route, stop_time) VALUES (2, 1, '00:15:00');
INSERT INTO station_has_railway_route (station_id_station, railway_route_id_railway_route, stop_time) VALUES (3, 1, '00:30:00');
INSERT INTO station_has_railway_route (station_id_station, railway_route_id_railway_route, stop_time) VALUES (4, 1, '00:20:00');
INSERT INTO station_has_railway_route (station_id_station, railway_route_id_railway_route, stop_time) VALUES (5, 1, '00:15:00');
INSERT INTO station_has_railway_route (station_id_station, railway_route_id_railway_route, stop_time) VALUES (6, 1, '00:10:00');
INSERT INTO station_has_railway_route (station_id_station, railway_route_id_railway_route, stop_time) VALUES (7, 1, '00:15:00');
INSERT INTO station_has_railway_route (station_id_station, railway_route_id_railway_route, stop_time) VALUES (8, 1, '00:00:00');

INSERT INTO station_has_railway_route (station_id_station, railway_route_id_railway_route, stop_time) VALUES (1, 2, '00:00:00');
INSERT INTO station_has_railway_route (station_id_station, railway_route_id_railway_route, stop_time) VALUES (3, 2, '00:10:00');
INSERT INTO station_has_railway_route (station_id_station, railway_route_id_railway_route, stop_time) VALUES (4, 2, '00:30:00');
INSERT INTO station_has_railway_route (station_id_station, railway_route_id_railway_route, stop_time) VALUES (5, 2, '00:45:00');
INSERT INTO station_has_railway_route (station_id_station, railway_route_id_railway_route, stop_time) VALUES (7, 2, '00:15:00');
INSERT INTO station_has_railway_route (station_id_station, railway_route_id_railway_route, stop_time) VALUES (8, 2, '00:00:00');

INSERT INTO station_has_railway_route (station_id_station, railway_route_id_railway_route, stop_time) VALUES (1, 3, '00:00:00');
INSERT INTO station_has_railway_route (station_id_station, railway_route_id_railway_route, stop_time) VALUES (2, 3, '00:22:00');
INSERT INTO station_has_railway_route (station_id_station, railway_route_id_railway_route, stop_time) VALUES (3, 3, '00:41:00');
INSERT INTO station_has_railway_route (station_id_station, railway_route_id_railway_route, stop_time) VALUES (6, 3, '00:15:00');
INSERT INTO station_has_railway_route (station_id_station, railway_route_id_railway_route, stop_time) VALUES (8, 3, '00:00:00');

